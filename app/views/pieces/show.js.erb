
var current_piece_id = <%= @piece.id %>
var current_position_id = '#' + <%= raw @piece_pos_id.inspect %>
var current_position_color = $(current_position_id).css("background-color");
var current_piece_class =  "<%= @piece.color + '_' + @piece.type.downcase %>"
var selected_piece = current_position_id + " ." + current_piece_class, //ex: #h2 .black_pawn
    selected_piece_url = '/pieces/' + current_piece_id

$(current_position_id).css("background-color", "red");

// modify to be draggable only when clicked =================

$("." + current_piece_class).draggable({
  drag: function(){
    $(current_position_id).css("background-color", current_position_color);
  }
});

//Every chess tile accepts a draggable
$("#chess tr > td").droppable({
  drop: updatePieceCoordinates
});


//Handles Drop Event and triggers ajax PUT request
function updatePieceCoordinates(event, ui){
  var destination_id = $(this).attr("id"), //"e7"
      destination_x = destination_id[0],
      destination_y = destination_id[1];

  var $this = $(this);
   ui.draggable.position({
    my: "center",
    at: "center",
    of: $this
   });

  $(ui.draggable).attr("style", "position: relative;");
  href = $(ui.draggable).parent();
  detached_draggable = $(href).detach();
  destination_id = '#'+ destination_id;

  detached_draggable.attr("style", "position: relative;");
  $(destination_id).append(detached_draggable);

  $.ajax({
    method: "PUT",
    url: selected_piece_url,
    data: { piece: {x: destination_x, y: destination_y} },
  })
}
